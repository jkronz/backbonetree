!function(){var a,b,c=function(a,b){return function(){return a.apply(b,arguments)}},d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};window.compactTree={},compactTree.CompactTree=function(b){function d(){return this.template=c(this.template,this),this.calculateSelected=c(this.calculateSelected,this),this.refreshViewport=c(this.refreshViewport,this),this.showParent=c(this.showParent,this),a=d.__super__.constructor.apply(this,arguments)}return e(d,b),d.prototype.className="compact-tree",d.prototype.events={"click .back":"showParent"},d.prototype.initialize=function(a){return this.tree=a.tree,this.childViews=[],this.nameField=a.nameField,this.listenTo(this,"compact-tree:updateViewport",this.refreshViewport),this._selected="string"==typeof a.selected?function(b){return b[a.selected]}:a.selected,this.calculateSelected(this.tree,null)},d.prototype.render=function(){return this.root=new compactTree.CompactTreeNode({node:this.tree,parent:null,nameField:this.nameField,treeView:this}),this.childViews.push(this.root),this.root.render(),this.$el.html(this.template()),this.refreshViewport(null),this},d.prototype.showParent=function(a){return this.refreshViewport(this.currentView.parent),null!=a&&a.stopPropagation(),null!=a?a.preventDefault():void 0},d.prototype.refreshViewport=function(a){return this.currentView=a,null!=this.currentView?(this.$(".back").show(),this.$(".tree-items").html(this.currentView.childMarkup())):(this.$(".tree-items").html(this.root.el),this.root.delegateEvents(),this.$(".back").hide())},d.prototype.calculateSelected=function(a,b){var c,d,e=this;return null!=a.children&&a.children.length>0?null!=b&&b.allSelected||this._selected(a)?(a.allSelected=!0,_.each(a.children,function(b){return e.calculateSelected(b,a)})):(d=_.map(a.children,function(b){return e.calculateSelected(b,a)}),c=_.any(d),a.anySelected=c||_.any(a.children,function(a){return a.anySelected}),a.allSelected=c&&_.all(d)):a.allSelected=null!=b&&b.allSelected||this._selected(a),a.allSelected},d.prototype.remove=function(){return _.each(this.childViews,function(a){return a.remove()}),this.stopListening(),this.undelegateEvents(),d.__super__.remove.call(this)},d.prototype.template=function(){return'<a class="back" href="#"><i class="icon-caret-left"></i> Back</a>\n<ul class="tree-items"></ul>'},d}(Backbone.View),compactTree.CompactTreeNode=function(a){function d(){return this.remove=c(this.remove,this),this.closeChildren=c(this.closeChildren,this),this.childMarkup=c(this.childMarkup,this),this.render=c(this.render,this),this.triggerCurrentViewport=c(this.triggerCurrentViewport,this),b=d.__super__.constructor.apply(this,arguments)}return e(d,a),d.prototype.tagName="li",d.prototype.events={"click > a.expand":"triggerCurrentViewport"},d.prototype.initialize=function(a){return this.node=a.node,this.parent=a.parent,this.treeView=a.treeView,this.nameField=a.nameField,this.childViews=[]},d.prototype.triggerCurrentViewport=function(a){return this.treeView.trigger("compact-tree:updateViewport",this),null!=a&&a.stopPropagation(),null!=a?a.preventDefault():void 0},d.prototype.render=function(){var a=this;return this.$el.html(this.template()),this.delegateEvents(),_.each(this.node.children,function(b){var c;return c=new compactTree.CompactTreeNode({parent:a,treeView:a.treeView,node:b,nameField:a.nameField}),a.childViews.push(c.render())}),this},d.prototype.childMarkup=function(){var a;return a=document.createDocumentFragment(),_.each(this.childViews,function(b){return a.appendChild(b.el),b.delegateEvents()}),a},d.prototype.template=function(){var a;return a=this.node.allSelected?"icon-check":this.node.anySelected?"icon-check-minus":"icon-check-empty",null!=this.node.children&&this.node.children.length?'<i class="'+a+'"></i>\n<a href="#" class="expand"> '+this.node[this.nameField]+' <i class="icon-caret-right"></i></a>':'<i class="'+a+'"></i>\n'+this.node[this.nameField]},d.prototype.closeChildren=function(){return _.each(this.childViews,function(a){return a.remove()})},d.prototype.remove=function(){return this.closeChildren(),this.undelegateEvents(),this.stopListening(),d.__super__.remove.call(this)},d}(Backbone.View)}.call(this);